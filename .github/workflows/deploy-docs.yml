name: Deploy Docs

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    strategy:
      matrix:
        include:
          - repo_url: https://github.com/qian-o/Zenith.NET
            docs_folder: documents
            output_folder: Zenith.NET

    steps:
      - uses: actions/checkout@v6

      - name: Clone Repository
        run: git clone ${{ matrix.repo_url }} source-repo

      - name: Setup .NET
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: 10.0.x

      - name: Install Workload
        run: dotnet workload install maui

      - name: Install DocFX
        run: dotnet tool install -g docfx

      - name: Build
        run: docfx source-repo/${{ matrix.docs_folder }}/docfx.json
        continue-on-error: true

      - name: Copy Output
        run: |
          rm -rf "${{ matrix.output_folder }}"
          cp -r "source-repo/${{ matrix.docs_folder }}/_site" "${{ matrix.output_folder }}"

      - name: Commit and Push
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add "${{ matrix.output_folder }}"
          git diff --staged --quiet || (git commit -m "Update ${{ matrix.output_folder }} documentation" && git push)
